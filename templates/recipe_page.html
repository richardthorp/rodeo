{% extends 'base.html' %}
{% block content %}
{% if session['username'] == recipe.added_by %}
<div class="rounded-container mx-auto text-center pt-2 pb-2">
    <span>
        <strong>Thank you for adding this recipe!</strong>
    </span>
    <span class="d-block d-sm-inline mt-2">
        <a href="{{ url_for('edit_recipe', recipe_id=recipe._id) }}"><button
                class="custom-button ml-3">Edit</button></a>
        <a href="{{ url_for('delete_recipe', recipe_id=recipe._id) }}"><button
                class="delete-button ml-3">Delete</button></a>
    </span>
</div>
{% endif %}
<div class="recipe-header rounded-container mx-auto">
    <h1 class="logo-font text-center header">{{ recipe.name }}</h1>
    <p class="recipe-added-by text-center text-muted">Recipe added by {{ recipe.added_by }}</p>
    <p class="serves-details sub-header text-center">Serves {{ recipe.feeds }}</p>
    <ul class="sub-header recipe-details-list d-flex justify-content-center mx-auto flex-wrap">
        {% for detail in recipe.details.values() %}
        <li>{{ detail }} <i class="fas fa-check-circle"></i></li>
        {% endfor %}
    </ul>
    <img src="{{ url_for('get_image', image_name = image_name) }}" alt="">
    <div class="row d-flex justify-content-between rating-row mx-auto">
        <!-- AVERAGE RATING SECTION -->
        <div class="d-none d-md-inline col-md-4 text-center">
            <h6 class="sub-header">Average Rating</h6>
            {% if average_rating == 1 %}
            <span class="star coloured-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            {% elif average_rating == 2 %}
            <span class="star coloured-star">&#9733;</span>
            <span class="star coloured-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            {% elif average_rating == 3 %}
            <span class="star coloured-star">&#9733;</span>
            <span class="star coloured-star">&#9733;</span>
            <span class="star coloured-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            {% elif average_rating == 4 %}
            <span class="star coloured-star">&#9733;</span>
            <span class="star coloured-star">&#9733;</span>
            <span class="star coloured-star">&#9733;</span>
            <span class="star coloured-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            {% elif average_rating == 5 %}
            <span class="star coloured-star">&#9733;</span>
            <span class="star coloured-star">&#9733;</span>
            <span class="star coloured-star">&#9733;</span>
            <span class="star coloured-star">&#9733;</span>
            <span class="star coloured-star">&#9733;</span>
            {% else %}
            <span class="star blank-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            <span class="star blank-star">&#9733;</span>
            {% endif %}
        </div>
        <!-- USER RATING SECTION -->
        <div class="d-none d-md-flex col-md-4 flex-wrap justify-content-center your-rating">
            <h6 class="sub-header text-center">Your Rating</h6>
            <form class="rating-form-md" name="rating-form" method="POST"
                action="{{ url_for('recipe_page', recipe_id=recipe._id) }}">
                <div class="rate rate-md">
                    {% if user_rating == 1 %}
                    <input type="radio" id="star5" name="rating" value="5" />
                    <label for="star5" title="text">&#9733;</label>
                    <input type="radio" id="star4" name="rating" value="4" />
                    <label for="star4" title="text">&#9733;</label>
                    <input type="radio" id="star3" name="rating" value="3" />
                    <label for="star3" title="text">&#9733;</label>
                    <input type="radio" id="star2" name="rating" value="2" />
                    <label for="star2" title="text">&#9733;</label>
                    <input type="radio" id="star1" name="rating" value="1" checked />
                    <label for="star1" title="text">&#9733;</label>
                    {% elif user_rating == 2 %}
                    <input type="radio" id="star5" name="rating" value="5" />
                    <label for="star5" title="text">&#9733;</label>
                    <input type="radio" id="star4" name="rating" value="4" />
                    <label for="star4" title="text">&#9733;</label>
                    <input type="radio" id="star3" name="rating" value="3" />
                    <label for="star3" title="text">&#9733;</label>
                    <input type="radio" id="star2" name="rating" value="2" checked />
                    <label for="star2" title="text">&#9733;</label>
                    <input type="radio" id="star1" name="rating" value="1" />
                    <label for="star1" title="text">&#9733;</label>
                    {% elif user_rating == 3 %}
                    <input type="radio" id="star5" name="rating" value="5" />
                    <label for="star5" title="text">&#9733;</label>
                    <input type="radio" id="star4" name="rating" value="4" />
                    <label for="star4" title="text">&#9733;</label>
                    <input type="radio" id="star3" name="rating" value="3" checked />
                    <label for="star3" title="text">&#9733;</label>
                    <input type="radio" id="star2" name="rating" value="2" />
                    <label for="star2" title="text">&#9733;</label>
                    <input type="radio" id="star1" name="rating" value="1" />
                    <label for="star1" title="text">&#9733;</label>
                    {% elif user_rating == 4 %}
                    <input type="radio" id="star5" name="rating" value="5" />
                    <label for="star5" title="text">&#9733;</label>
                    <input type="radio" id="star4" name="rating" value="4" checked />
                    <label for="star4" title="text">&#9733;</label>
                    <input type="radio" id="star3" name="rating" value="3" />
                    <label for="star3" title="text">&#9733;</label>
                    <input type="radio" id="star2" name="rating" value="2" />
                    <label for="star2" title="text">&#9733;</label>
                    <input type="radio" id="star1" name="rating" value="1" />
                    <label for="star1" title="text">&#9733;</label>
                    {% elif user_rating == 5 %}
                    <input type="radio" id="star5" name="rating" value="5" checked />
                    <label for="star5" title="text">&#9733;</label>
                    <input type="radio" id="star4" name="rating" value="4" />
                    <label for="star4" title="text">&#9733;</label>
                    <input type="radio" id="star3" name="rating" value="3" />
                    <label for="star3" title="text">&#9733;</label>
                    <input type="radio" id="star2" name="rating" value="2" />
                    <label for="star2" title="text">&#9733;</label>
                    <input type="radio" id="star1" name="rating" value="1" />
                    <label for="star1" title="text">&#9733;</label>
                    {% else %}
                    <input type="radio" id="star5" name="rating" value="5" />
                    <label for="star5" title="text">&#9733;</label>
                    <input type="radio" id="star4" name="rating" value="4" />
                    <label for="star4" title="text">&#9733;</label>
                    <input type="radio" id="star3" name="rating" value="3" />
                    <label for="star3" title="text">&#9733;</label>
                    <input type="radio" id="star2" name="rating" value="2" />
                    <label for="star2" title="text">&#9733;</label>
                    <input type="radio" id="star1" name="rating" value="1" />
                    <label for="star1" title="text">&#9733;</label>
                    {% endif %}
                </div>
                <!-- If user is logged in, provide submit button - otherwise provide popover with links to log in and register -->
                {% if session['username'] %}
                <input class="custom-button add-rating-btn mt-2" type="submit" value="Add Rating">
                {% else %}
                <a tabindex="0" class="sign-in-popover mx-auto" role="button" data-toggle="popover" data-trigger="focus"
                    data-placement="bottom" data-content="<a href='{{ url_for('login') }}'><b>LOG IN</b></a> or 
                        <a href='{{ url_for('register') }}'><b>REGISTER</b></a> to save recipes to your favourites!">
                    <div class="custom-button add-rating-btn mt-2 text-center p-1">Add Rating</div>
                </a>
                {% endif  %}
            </form>
        </div>
        <div class="col-6 d-md-none text-center d-flex align-items-center justify-content-center">


            <button type="button" class="custom-button ratings-button" data-toggle="modal" data-target="#rating-modal">
                View<br>Ratings
            </button>
            <!-- RATINGS MODAL -->
            <div class="modal fade" id="rating-modal" tabindex="-1" aria-labelledby="rating modal" aria-hidden="true">
                <div id="ratings-modal" class="modal-dialog modal-dialog-centered">
                    <div class="modal-content text-left">
                        <div class="modal-header">
                            <button type="button" class="custom-button" data-dismiss="modal">Close</button>
                        </div>
                        <!-- AVERAGE RATING SECTION -->
                        <div class="modal-body">
                            <h6 class="sub-header text-muted">Average Rating</h6>
                            {% if average_rating == 1 %}
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            {% elif average_rating == 2 %}
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            {% elif average_rating == 3 %}
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            {% elif average_rating == 4 %}
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            {% elif average_rating == 5 %}
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star coloured-star">&#9733;</span>
                            <span class="star coloured-star">&#9733;</span>
                            {% else %}
                            <span class="star blank-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            <span class="star blank-star">&#9733;</span>
                            {% endif %}
                            <!-- USER RATING SECTION -->
                            <form method="POST" action="{{ url_for('recipe_page', recipe_id=recipe._id) }}">
                                <h6 class="sub-header text-muted mt-4">Your Rating</h6>
                                <div class="rate">
                                    <input type="radio" id="star5-modal" name="rating" value="5" />
                                    <label for="star5-modal" title="text">&#9733;</label>
                                    <input type="radio" id="star4-modal" name="rating" value="4" />
                                    <label for="star4-modal" title="text">&#9733;</label>
                                    <input type="radio" id="star3-modal" name="rating" value="3" />
                                    <label for="star3-modal" title="text">&#9733;</label>
                                    <input type="radio" id="star2-modal" name="rating" value="2" />
                                    <label for="star2-modal" title="text">&#9733;</label>
                                    <input type="radio" id="star1-modal" name="rating" value="1" />
                                    <label for="star1-modal" title="text">&#9733;</label>
                                </div>
                                <div>

                                    <!-- If user is logged in, provide submit button - otherwise provide popover with links to log in and register -->
                                    {% if session['username'] %}
                                    <input class="custom-button add-rating-btn mt-2" type="submit" value="Add Rating">
                                    {% else %}
                                    <a tabindex="0" class="sign-in-popover" role="button" data-toggle="popover"
                                        data-trigger="focus" data-placement="bottom"
                                        data-content="<a href='{{ url_for('login') }}'><b>LOG IN</b></a> or 
                                        <a href='{{ url_for('register') }}'><b>REGISTER</b></a> to save recipes to your favourites!">
                                        <div class="custom-button add-rating-btn mt-2 text-center p-1">Add Rating</div>
                                    </a>
                                    {% endif  %}
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-6 col-md-4 text-center">
            <!-- ADD TO FAVOURITES SECTION -->
            <h6 class="sub-header text-center">Add to Favourites</h6>
            <!-- If user is logged in -->
            {% if session['username'] %}
            <form id="favourite-form" class="trigger-form-send" method="POST"
                action="{{ url_for('toggle_favourite', recipe_id=recipe._id, return_page='recipe_page') }}">
                <!-- If user has favourited this recipe previously -->
                {% if session['username'] in recipe.favourites %}
                <input type="checkbox" class="hidden-input" name="favourite" id="favourite-checkbox-checked"
                    value="delete_fav">
                <label class="favourite-toggle" for="favourite-checkbox-checked"><i class="fas fa-heart"></i></label>
                {% else %}
                <input type="checkbox" class="hidden-input" name="favourite" id="favourite-checkbox-unchecked"
                    value="add_fav">
                <label class="favourite-toggle" for="favourite-checkbox-unchecked"><i class="far fa-heart"></i></label>
                {% endif %}
                {% else %}
                <!-- User not logged in - provide popover with links to log in and register  -->
                <div class="favourite-toggle">
                    <a tabindex="0" class="sign-in-popover" role="button" data-toggle="popover" data-trigger="focus"
                        data-placement="bottom" data-content="<a href='{{ url_for('login') }}'><b>LOG IN</b></a> or 
                    <a href='{{ url_for('register') }}'><b>REGISTER</b></a> to save recipes to your favourites!">
                        <i class="far fa-heart"></i></a></div>

                {% endif %}
            </form>
        </div>
    </div>
    <!--END OF LOGGED IN USER VIEW-->

</div>

<div class="row">
    <div class="col-12 col-lg-6">
        <div class="ingredients-section rounded-container mx-auto">
            <h3 class="sub-header text-center">Ingredients</h3>
            {% for ingredient in recipe.ingredients %}
            <li>{{ ingredient }}</li>
            {% endfor %}
        </div>
    </div>
    <div class="col-12 col-lg-6">
        <div class="instructions-section rounded-container mx-auto">
            <h3 class="sub-header text-center">Instructions</h3>
            <ul>
                {% for instruction in recipe.instructions %}
                <h6 class="sub-header">Step {{loop.index}}</h6>
                <li>{{ instruction }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endblock %}