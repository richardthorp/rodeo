{% extends 'base.html' %} {% block content %}
<div class="container-fluid block-content-container">
  <h1 class="logo-font text-center header">My Recipes</h1>
  <!-- MY RECIPES NAVIGATION BUTTONS -->
  <div class="row d-flex justify-content-around mt-3 mt-lg-5 no-gutters">
    <div class="col-4 d-flex justify-content-center">
      <a href="{{ url_for('my_recipes') }}" class="my-recipe-buttons">
        <div class="text-center sub-header">
          <p><i class="fas fa-heart"></i>View my favourite recipes</p>
        </div>
      </a>
    </div>
    <div class="col-4 d-flex justify-content-center">
      <a href="{{ url_for('added_recipes') }}" class="my-recipe-buttons current-button">
        <div class="text-center sub-header">
          <p><i class="fas fa-pencil-alt"></i>View my added recipes</p>
        </div>
      </a>
    </div>
    <div class="col-4 d-flex justify-content-center">
      <a href="{{ url_for('add_recipe') }}" class="my-recipe-buttons">
        <div class="text-center sub-header">
          <p><i class="far fa-plus-square"></i>Add a new recipe</p>
        </div>
      </a>
    </div>
  </div>
  {% if recipes_count == 0 %}
  <!-- USER HASN'T ADDED ANY RECIPES -->
  <div class="add-fav-or-recipe">
    <h2 class="sub-header text-center mt-5">Add Your Recipes</h2>
    <p class="text-center">
      <strong>Share your recipes with the community by clicking the
        <a href="{{url_for('add_recipe')}}">Add a new recipe</a> button just above
        here!</strong>
    </p>
  </div>
  {% else %}
  <!-- USER HAS ADDED RECIPES -->
  <!-- SEARCH AND FILTER CONTAINER -->
  <div class="row search-container rounded-container mx-auto">
    <div class="col-12">
      <form method="POST"
        action="{{ url_for('search_results', return_page='added_recipes', sort_by='average_rating')}}">
        <div class="row">
          {{ form.hidden_tag() }}
          <div class="col-12 col-sm-8">
            <div class="sub-header text-left mt-2 mb-1">
              Search for a recipe or ingredient
            </div>
            {{ form.search(class="form-input mb-2") }} {{
            form.search_submit(class="custom-button") }}
          </div>
          <div class="col-12 col-sm-4">
            <div class="sub-header text-right m-1">Filter recipes</div>
            <div class="dropdown text-right">
              <button class="btn btn-secondary dropdown-toggle custom-button" type="button" id="dropdownMenuButton"
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Filter
              </button>
              <div class="dropdown-menu filter-dropdown" aria-labelledby="dropdownMenuButton">
                <h6 class="dropdown-header sub-header">Recipe Type</h6>
                {{ form.recipe_type(class="dropdown-item") }}
                <div class="dropdown-divider"></div>
                <h6 class="dropdown-header sub-header">Recipe Options</h6>
                <div class="filter-option">
                  {{ form.cheap_checkbox() }} {{ form.cheap_checkbox.label() }}
                </div>
                <div class="filter-option">
                  {{ form.gluton_free_checkbox() }} {{
                  form.gluton_free_checkbox.label() }}
                </div>
                <div class="filter-option">
                  {{ form.fakeaway_checkbox() }} {{
                  form.fakeaway_checkbox.label() }}
                </div>
                <div class="filter-option">
                  {{ form.healthy_checkbox() }} {{ form.healthy_checkbox.label()
                  }}
                </div>
                <div class="filter-option">
                  {{ form.quick_checkbox() }} {{ form.quick_checkbox.label() }}
                </div>
                {{ form.filter_submit(class="custom-button d-flex mx-auto") }}
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
  {% if filters %}
  <!-- User has used search or filter - provide 'remove search and filter' button -->
  <a href="{{ url_for('clear_search', return_page='added_recipes') }}">
    <div class="text-center mt-3 custom-button remove-filters-button mx-auto">
      Remove Search terms and Filters
    </div>
  </a>
  <!-- User has used search or filter - but the query returned no results -->
  {% if filters and recipe_count == 0 %}
  <div class="m-5 text-center">
    <h2 class="sub-header text-center mt-5">No recipes found!</h2>
    <p>
      <strong>Please adjust your search term or filters and try again.</strong>
    </p>
  </div>
  {% elif filters and recipe_count > 0 %}
  <!-- If user sorts by rating / new with filters, send request to search_results route -->
  <p class="mb-0 mt-2 mt-md-3 mt-lg-4 ml-lg-4">
    Sort recipes by:
    <a href="{{ url_for('search_results', return_page='added_recipes', sort_by='average_rating') }}">rating</a> /
    <a href="{{ url_for('search_results', return_page='added_recipes', sort_by='_id') }}">newest</a>
  </p>
  {% endif %}
  {% else %}
  <!-- If user sorts by rating / new without filters, send request to added_recipes route -->
  <p class="mb-0 mt-2 mt-md-3 mt-lg-4 ml-lg-4">
    Sort recipes by:
    <a href="{{ url_for('added_recipes', sort_by='average_rating') }}">rating</a> /
    <a href="{{ url_for('added_recipes', sort_by='_id') }}">newest</a>
  </p>
  {% endif %}
  <!-- RECIPE CARDS -->
  <div class="row row-eq-height">
    {% for recipe in recipes %}
    <div class="col-12 col-md-6 col-lg-4 d-flex justify-content-center">
      <div class="recipe-card added-recipe-card">
        <a href="{{url_for('recipe_page', recipe_id=recipe._id)}}">
          <!-- RECIPE CARD IMAGE -->
          <div class="recipe-image-container">
            {% if recipe.image_name == 'default-image' %}
            <img src="/static/images/default-image.jpg" alt="Illustration of Rodeo Hot Sauce bottle" />
            {% else %}
            <img src="{{ url_for('get_image', image_name = recipe.image_name) }}" alt="" />
            {% endif %}
          </div>
          <!-- RECIPE TITLE -->
          <h4 class="recipe-card-title logo-font text-center">
            {{ recipe.name }}
          </h4>
        </a>
        <div class="recipe-card-footer row">
          <!-- AVERAGE RATING SECTION -->
          <div class="col-6 text-center recipe-card-ratings">
            <h6 class="sub-header mt-3">Average<br />Rating</h6>
            <div class="ratings-container">
              <!-- Stars rendered in scripts.js -->
              {{ recipe.average_rating }}
            </div>
          </div>
          <!-- ADD TO FAVOURITES SECTION -->
          <div class="col-6 text-center">
            <h6 class="sub-header mt-3">Favourite<br />Recipe?</h6>
            <!-- If user is logged in -->
            {% if session['username'] %}
            <form class="trigger-form-send" method="POST"
              action="{{ url_for('toggle_favourite', recipe_id=recipe._id, return_page='added_recipes',
                                 page=page, sort_by=sort_by, filters=filters) }}">
              <!-- If user has favourited this recipe previously, render solid heart icon -->
              {% if session['username'] in recipe.favourites %}
              <input type="checkbox" name="favourite" class="hidden-input"
                id="favourite-checkbox-checked-{{+ loop.index}}" value="delete_fav" />
              <label for="favourite-checkbox-checked-{{+ loop.index}}"><i class="fas fa-heart" data-toggle="tooltip"
                  data-placement="bottom" title="Remove from favourites"></i></label>
              <!-- If user has not favourited recipe, render outline heart icon -->
              {% else %}
              <input type="checkbox" name="favourite" class="hidden-input"
                id="favourite-checkbox-unchecked-{{+ loop.index}}" value="add_fav" />
              <label for="favourite-checkbox-unchecked-{{+ loop.index}}"><i class="far fa-heart" data-toggle="tooltip"
                  data-placement="bottom" title="Add to favourites"></i></label>
              {% endif %}
            </form>
            <!-- User not logged in - provide popover with links to log in and register  -->
            {% else %}
            <a tabindex="0" class="sign-in-popover" role="button" data-toggle="popover" data-trigger="focus"
              data-placement="bottom" data-content="<a href='{{ url_for('login') }}'><b>LOG IN</b></a> or 
                        <a href='{{ url_for('register') }}'><b>REGISTER</b></a> to save recipes to your favourites!">
              <i class="far fa-heart"></i>
            </a>
            {% endif %}
          </div>
        </div>
        <hr />
        <div class="row">
          <div class="col-12 text-center mt-2">
            <a href="{{ url_for('edit_recipe', recipe_id=recipe._id) }}"><button
                class="custom-button ml-3">Edit</button>
            </a>
            <button class="delete-button ml-3" data-toggle="modal" data-target="#delete-recipe-modal-{{+loop.index}}">
              Delete
            </button>
          </div>
        </div>
        <!-- DELETE RECIPE MODAL -->
        <div class="modal fade" id="delete-recipe-modal-{{+loop.index}}" tabindex="-1"
          aria-labelledby="delete-recipe-modal" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-body text-center">
                <strong>Are you sure you want to delete this recipe?<br />This cannot
                  be undone!</strong>
              </div>
              <div class="modal-footer justify-content-center">
                <button type="button" class="custom-button" data-dismiss="modal">
                  Close
                </button>
                <a
                  href="{{ url_for('delete_recipe', recipe_id=recipe._id, page=page, sort_by=sort_by, filters=filters) }}"><button
                    type="button" class="delete-button">
                    Delete Recipe
                  </button></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %} {% endif %}
  </div>
</div>
{% endblock %}